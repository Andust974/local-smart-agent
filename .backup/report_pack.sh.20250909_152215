#!/usr/bin/env bash
set -Eeuo pipefail
BASE="${HOME}/ai-agent/projects/local_smart_agent"
REPORTS_DIR="$BASE/reports"
OUT_BUNDLE="$REPORTS_DIR/bundle_$(date +%Y%m%d_%H%M%S).zip"
COUNT="${1:-5}"

mkdir -p "$REPORTS_DIR"

# Если отчетов нет — создадим заглушки, чтобы zip не был пустым
if ! ls "$REPORTS_DIR"/*.html >/dev/null 2>&1; then
  for i in 1 2 3; do
    printf '<html><body><h1>Report %s (placeholder)</h1></body></html>\n' "$i" > "$REPORTS_DIR/report_placeholder_$i.html"
  done
fi

# Берём N последних HTML-отчетов по времени изменения
FILES=$(ls -1t "$REPORTS_DIR"/*.html | head -n "$COUNT")
# Собираем ZIP
zip -q -j "$OUT_BUNDLE" $FILES

echo "$OUT_BUNDLE"
