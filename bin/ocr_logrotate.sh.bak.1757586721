#!/usr/bin/env bash
set -u
ROOT="/home/andrei-work/ai-agent/projects/local_smart_agent"
ARCH="$ROOT/logs/archive"
mkdir -p "$ARCH"

rotate_one() {
  local f="$1" max_bytes="${2:-5242880}"  # 5 MiB
  [[ -f "$f" ]] || return 0
  sz=$(stat -c%s "$f" 2>/dev/null || echo 0)
  if (( sz > max_bytes )); then
    ts=$(date +%Y%m%d_%H%M%S)
    gzip -c "$f" > "$ARCH/$(basename "$f").$ts.gz" && : > "$f"
    echo "[logrotate] $(basename "$f") -> archive ($sz bytes)"
  fi
}

rotate_one "$ROOT/logs/ocr_norm.log"
rotate_one "$ROOT/logs/ocr_parse.log"
rotate_one "$ROOT/logs/ocr_pipeline.log"
rotate_one "$ROOT/logs/ocr_cleanup.log"
rotate_one "$ROOT/logs/ocr_summary.log"
